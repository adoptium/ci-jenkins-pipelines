/*
Jenkins job does reproducible build compare.
*/
import groovy.json.JsonOutput

pipeline {
    agent { label 'dockerBuild&&linux&&x64' }
    parameters {
        string(name: 'COMPARED_JOB_NUMBER', defaultValue: '', description: 'Compared nightly build job name')
        string(name: 'COMPARED_JOB_NAME', defaultValue: '', description: 'Compared nightly build job number')
        string(name: 'COMPARED_JOB_PARAMS', defaultValue: '', description: 'Compared nightly build job parameters')
    }

    stages {
        stage('Compare') {
            steps {
                cleanWs()
                checkout scm
                checkout([$class: 'GitSCM', branches: [[name: 'master']], doGenerateSubmoduleConfigurations: false, extensions: [[$class: 'RelativeTargetDirectory', relativeTargetDir: "temurin-build"]], submoduleCfg: [], userRemoteConfigs: [[url: "https://github.com/adoptium/temurin-build.git"]]])
                script {
                    try {
                        dir('temurin-build/tooling') {
                            def rc = 0
                            rc = sh returnStatus: true, script: "echo 'hello' > repro_diff.out"
                            sh returnStatus: true, script: "ls"
                            currentBuild.result = 'FAILURE'

                            error 'Error: two builds are not the same!'
							archiveArtifacts artifacts: "**/repro_diff.out"
                        }
                        echo "are we here"
                        archiveArtifacts artifacts: "**/repro_diff.out"
                    } catch (Exception err) {
                        echo err.getMessage()
                        currentBuild.result = 'FAILURE'
                    } finally {
                        cleanWs()
                    }
                    echo " can be here?"
                }
            }
        }
    }
}